---
layout: 12pt
header-includes:
   - \usepackage{lineno}
   - \linenumbers
   - \usepackage{setspace}
   - \doublespacing
bibliography: ~/Dropbox/Bibliography/MicroMeso.bib
csl: components/ecology.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: true
fontsize: 12pt
geometry: margin=1in

---

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\begin{centering}
\textbf{\large{Remote-sensing based population models for projecting climate change impacts on plant populations at large spatial extents: a test case with sagebrush (\emph{Artemisia}) species}}

\textsc{\small{Andrew T. Tredennick\footnote{E-mail: atredenn@gmail.com}\textsuperscript{1}, Mevin B. Hooten\textsuperscript{2,3,4,5}, Cameron L. Aldridge\textsuperscript{5,6,7}, Colin G. Homer, David T. Iles\textsuperscript{1}, Andrew Kleinhesselink\textsuperscript{1}, Eric LaMalfa\textsuperscript{1}, Rebecca Mann\textsuperscript{1}, and Peter B. Adler\textsuperscript{1}}}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, 5230 Old Main Hill, Utah State University, Logan, Utah 84322-5230 USA}} \\*
\textit{\small{\textsuperscript{2}U.S. Geological Survey, Colorado Cooperative Fish and Wildlife Research Unit}} \\*
\textit{\small{\textsuperscript{3}Department of Fish, Wildlife, and Conservation Biology, Colorado State University}} \\*
\textit{\small{\textsuperscript{4}Department of Statistics, Colorado State University}} \\*
\textit{\small{\textsuperscript{5}Graduate Degree Program in Ecology, Colorado State University, Fort Collins, CO}} \\*
\textit{\small{\textsuperscript{6}Department of Ecosystem Science and Sustainability and Natural Resource Ecology Laboratory, Colorado State University}} \\*
\textit{\small{\textsuperscript{7}U.S. Geological Survey, Fort Collins Science Center}} \\*
\textit{\small{\textsuperscript{8}U.S. Geological Survey (USGS) Earth Resources Observation and Science (EROS) Center, Sioux Falls, SD}}

\end{centering}

\renewcommand*{\thefootnote}{\arabic{footnote}}

Abstract
--------
Global environmental changes, like climate change, tend to play out at the landscape and regional scales.
Thus, it is reasonable that attempts to forecast the impacts of such change do so at similar spatial scales.
For plant species, this has meant relying primarily on a single tool, species distribution models, that contain little information on population dynamics and states.
Plant population models have proven exceedingly useful for projecting population dynamics and states under altered climate regimes, but most models are parameterized using local scale data from, generally, 1 $\text{m}^{2}$ plots.
These models, even if highly predictive, cannot capture the full spatial variability in population responses to climate and thus are difficult to extrapolate from the micro to meso scale.
Here we build on density-structured population modeling approaches and describe a population model based on remote sensing pixels -- a `pixel-based' population model.
At its core the model is simply an individual-based population model where, instead of individuals, we focus on pixels as super individuals.
To demonstrate the approach, we model the rate of transitions among discrete percent cover classes using a 27 year remotely sensed time series of sagebrush (\emph{Artemesia} spp.) cover in southwestern Wyoming.
We use climate covariates in vital rate regressions so that we can forecast future population states under projected climate change.
The pixel-based population model successfully recovers the the mean and spread of the observed data when we use observed climate covariates. 


*Key words: population model, climate change, forecasting, remote sensing, sagebrush*, Artemesia 

Introduction
-------------
Forecasting the impacts of climate change on plant populations and communities is a central challenge of modern ecology.
The challenge lies in faithfully representing population dynamics at spatial and temporal scales relevant to policy and management decisions.
However, almost every study of plant population dynamics relies on demographic observations recorded at the meter to sub-meter scale.
Local-scale demographic data make building population projection models an easy task (Ellner et al., 2006; Rees et al., 2009; Adler et al., 2012), but it is very difficult to extrapolate small-scale studies to large spatial extents with any certainty because the data likely only represent a small subset of parameter space and environmental conditions.
Also, given the costliness (in time and money) of collecting detailed demographic data, it is unlikely that “enough” local-scale data can be collected to accurately project large-scale population dynamics. 

The fundamental limitation of local-scale data is that they are insufficient for estimating the full extent of variation in model parameters possible at larger spatial and temporal extents (Freckleton et al., 2011; Queenborough et al., 2011).
It is possible to estimate the variance of population model parameters related to spatial and temporal variability, but the observations used to estimate parameter uncertainty tend to be clustered in space or time.
Thus, extrapolating beyond the spatial or temporal resolution of the data used to parameterize models can lead to biased and wrong forecasts of future population states. 

Alternatively, large-scale trends in populations are easily detected using widely available monitoring data, but such data are rarely used to project future population states. 
Given the tradeoffs between the spatial-scale of data and the inference that can be drawn from the data, we suggest combining the best features of local-scale population modeling and large-scale monitoring data.
Specifically, we propose a new approach for modeling population dynamics at large spatial extents based on the theory and mechanics of individual-based models (IBMs) as applied to remotely-sensed time series data.

The approach we describe in this paper flows naturally from recent work on density-structured population models.
Density-structured models rely on modeling the transitions of a population among discrete states rather than the traditional approach of modeling the transitions of individuals.
Relatively few ecologists have taken up the density-structured mantle first proposed by Taylor, C. M. et al. (2004), but recently Freckleton et al. (2011) and Queenborough et al. (2011) have higlighted the potential value the approach.

Materials and Methods
---------------------
### Data: Remotely-sensed time series
To demonstrate our pixel-based modeling approach we use a subset of a remotely-sensed time series of sagebrush (\emph{Artemisia} spp.) shrub percent cover in Wyoming (Homer et al., 2012) (Figure 1).
Sagebrush percent cover was estimated using a regression tree to relate ground reflectances retrieved by three sources of optical imagery (QuickBird, Landsat, and AWiFS) to 1,780 field observations of sagebrush cover distributed across Wyoming.
The regression tree model was further validated using another 500 field observations. For Wyoming sagebrush, the model achieved an $R^{2}$ = 0.65.
To hind-cast sagebrush cover the regression tree model was applied to historical remote sensing images. This resulted in an annual time series of sagebrush cover at 30 m resolution from 1984 to 2011.
In this dataset, values represent the percentage of a 30 $\times$ 30 m pixel covered by sagebrush.
For our purposes we use two 5 $\times$ 5 km subsets (study areas 1 and 2), totaling 27,948 pixels each.
Thus, each full dataset contains 754,596 observations (27 years $\times$ 27,948 pixels).

### Data: Climate covariates
Our approach is based on modeling how changes in plant populations relate to climate variables.
We narrowed our focus to climate covariates we know are important for sagebrush and that could be easily calculated from general circulation model projections. The four climate variables in our population model are: (1) year \emph{t} fall through summer precipitation, (2) year \emph{t}-1 fall through summer precipitation, (3) year \emph{t} average spring temperature, and (4) year \emph{t}-1 average spring temperature (Table [tab:Definition-of-climate]).
Climate data to parameterize vital rate regressions (`observed' climate) came from the PRISM climate database. Climate data were extracted for the centroid our study area.

Climate data used to inform model projections of future sagebrush
cover came from average outputs of all models used in the most recent
IPCC report, the Coupled Model Intercomparison Project 5 (CMIP5; http://cmip-pcmdi.llnl.gov/cmip5/).
We downloaded model estimates of historic climate (1950-2000) and
projected climate (2050-2100) for the centroid of our study area.
We wanted to keep the temporal variability from observed climate consistent,
so our aim was to adjust observed climate according to projected changes.
For temperature we simply subtracted the average historic temperature
from the average projected temperature. For precipitation we calculated
the proportional change: we subtracted average projected precipitation
from average historic precipitation, and then divided by average historic
precipitation. We did this for three ``Representative Concentration
Pathways'': RCP 4.5, RCP 6.0, and RCP 8.5. RCPs are described here,
http://tntcat.iiasa.ac.at/RcpDb/.
Basically they correspond to stabilization of radiative forcing before
2100, after 2100, and increasing greenhouse gas emissions, respectively.
We implemented projected temperature and precipitation changes in
the model by perturbing observed annual values by the values in Table #.

\begin{table}[h]
\protect\caption{\label{tab:Changes-in-climate}Changes in climate variables from CMIP5
average projections.}
\begin{tabular}{llllll}
\hline
 & \multicolumn{2}{c}{Study Area 1} &  & \multicolumn{2}{c}{Study Area 2}\tabularnewline 
Emissions Scenario & $\Delta$ temperature & $\Delta$ precipitation &  & $\Delta$ temperature & $\Delta$ precipitation\tabularnewline
\hline
RCP 4.5 & 2.98\textdegree & 8.94\% &  & 3.04\textdegree & 7.42\%\tabularnewline
RCP 6.0 & 3.13\textdegree & 8.64\% &  & 3.23\textdegree & 6.72\%\tabularnewline
RCP 8.5 & 4.79\textdegree & 11.0\% &  & 4.90\textdegree & 8.81\%\tabularnewline
\hline
\end{tabular}
\end{table}

### Additive spatio-temporal model for sagebrush cover
We use a descriptive model for sagebrush cover that includes additive spatial and temporal effects (Conn et al. 2014).
Since the spatial and temporal effects are additive, we are not considering space-time interactions.
We model observed integer percent cover (*y*) in cell *i* at time *t* as conditionally negative binomial:

\begin{align}
y_{i,t} \sim \text{NegBinom}(\mu_{i,t}, \zeta)
\end{align}

where $\mu_{i,t}$ is the determinstic expected population growth:

\begin{align}
\text{log}(\mu_{i,t}) &= \underbrace{\beta_{0} + \beta_{1}y_{i,t-1}}_\text{temporal} + \underbrace{\textbf{x}_{t}'\boldsymbol{\gamma}}_\text{climate} + \underbrace{\eta_{i}}_\text{spatial}
\end{align}

Our model of population growth includes a temporal effect of cover in the previous year ($y_{i,t-1}$), climate effects ($\textbf{x}_t$), and a spatial random effect ($\eta$) for each pixel *i*.
Fitting the spatial random effect ($\eta$) is computationally demanding when the observations come from 10s of 1,000s locations.
The dimensionality is just too large.
To overcome these computational constraints we employed a dimension reduction strategy to reduce the number of parameters that need to be estimated to account for spatial variation.
A common strategy is to express high dimensional effects, like $\boldsymbol{\eta}$, as the product of an expansion matrix, \textbf{K}, and a smaller parameter vector, $\boldsymbol{\alpha}$.
We can then define the spatial effect as

\begin{align}
\boldsymbol{\eta} &= \textbf{K}\boldsymbol{\alpha} \\
\alpha_{j} &\sim \text{Normal}(0,\sigma_{\eta}^2)
\end{align}

In this case, $\boldsymbol{\alpha}$ is a $m \times 1$ vector of reduced spatial random effects, and \textbf{K} is a $S \times m$ matrix that maps the reduced effects to the full \emph{S}-dimensional space, where \emph{S} is the total number of observed locations.
Thus, we are able to reduce the effective number of parameters from ${S} \rightarrow m$.

Obviously, the last remaining obstacle is to parameterize \textbf{K}.
Here we use kernel convolution to interpolate the spatial random effect between \emph{m} "knots" that are nonrandomly distributed across the space of our study area.
This means we are modeling spatial random effects at the knot level, and we use \textbf{K} to interpolate those effects between knots.
We use an exponential kernel density to define the distance-decay function around the knots (\textbf{w}), such that the entries of \textbf{K} are

\begin{align}
K_{s,m} &= w_{s,m} / \sum_{s} w_{s,m}, \text{where} \\
w_{s,m} &= (2 \pi \sigma)^{-1} \text{exp}(\frac{-d_{s,m}}{2 \sigma})
\end{align}

where $d_{s,m}$ is the Euclidean distance between the centroid of sample cell \emph{s} and the location of knot \emph{m}, and $\sigma$ is the kernel bandwidth.
It is possible through exhaustive model selection and fitting to determine the optimal form of the kernel and to estimate optimal values for $\sigma$.
However, given the relative largeness of our dataset and computational limitations, we decided to to create kernels around 271 knots (Figure 2) whose nearest neighbor distances are approximately equal to the range of spatial dependence in residuals from a simple GLM fit without climate covariates and the spatial random effect (Appendix A).

The full model can be expressed as:

\begin{align}
[\boldsymbol{\beta}, \boldsymbol{\gamma}, \boldsymbol{\alpha}, \sigma_{\eta}^2, \zeta] \propto \left( \prod_{t=1}^{T} \prod_{i=1}^{n} [y_{i,t} | \boldsymbol{\beta}, \boldsymbol{\gamma},\boldsymbol{\alpha}, \zeta] \right) \prod_{j=1}^{J}[\alpha_j|\sigma_{\eta}^2][\beta_{0}][\beta_{1}][\gamma][\sigma^2][\sigma_{\eta}^2]
\end{align}

### Model estimation and model projections
We fit the model using the 'No-U-Turn' MCMC sampler in Stan.
We obtained posterior distributions of all model parmaters from 1,000 MCMC iterations after discarding an initial 1,000 iterations as burn in.
We assessed convergence visually and ensured all scale reduction factors were less than 1.01 (Gelman citation). 

With the posterior estimates of model parameters in hand, we were able to simulate a matrix of pixels equal to the size of the study area.
To do so, we initialized all pixels with arbitrarily low cover (1%) and then projected the model forward by randomly drawing climate covariates from the observed climate time series.
We ran the simulation for 2,500 time steps and then compared the output to the observed time series to see if the model could reproduce the observed cover.
We then ran simulations where the projected climate changes in Table 1 were applied to the observed climate time series.

Results
-------
Our pixel-based population model was able to reproduce observed percent cover (Figure 3).
Three of five climate covariates were strong predictors of cover change (Figure 4).
In particular, mean spring temperature and precipitation at time *t*-2 had strong positive effects on population growth, only slightly offset by a negative effect of precipitation at time  *t*-1.
The positive effects of precipitation and temperature resulted in projected increases of cover for all climate change scenarios (Figure 5) since precipitation and temperature are both predicted to increase (Table 1).

Discussion
-----------


\pagebreak{}

Figures
-------
```{r figure_1,dependson="plot-options", fig.cap="Location of the study area in southwester Wyoming and a snapshot of the percent cover data in 1984 for each site (a and b). Green shading on the map shows projected distribution of sagebrush from Kuchler (19xx). Latitude and longitude are in decimal degrees.", fig.height=6, eval=TRUE}
library(png)
library(grid)
img <- readPNG("components/figure/StudyAreasMap_1and2.png")
grid.raster(img)
```


```{r figure_2,dependson="plot-options", fig.cap="Average percent cover or each grid cell of the study area with knots used for spatial convolution in dimension reduction.", fig.height=6, eval=TRUE}
library(png)
library(grid)
img <- readPNG("components/figure/SAGE_Grid_wKnots.png")
grid.raster(img)
```

```{r figure_3,dependson="plot-options", fig.cap="Observed and predicted cover, averaged over years for each pixel. This histogram shows the distribution of observed cover and then density curve shows the distribution of predicted cover from the model.", fig.height=6, eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/obs_pred_spatial_small.png")
grid.raster(img)
```

```{r figure_4,dependson="plot-options", fig.cap="Posterior distributions of climate covariates.", fig.height=6, eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/climeff_dens_small.png")
grid.raster(img)
```

```{r figure_5,dependson="plot-options", fig.cap="Projected equilibrium cover under climate change scenarios. Top panels show the projections in space, averaged over time for each pixel. Lower panel shows distributions of cover under each scenario", fig.height=6, eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/climchange_small.png")
grid.raster(img)
```