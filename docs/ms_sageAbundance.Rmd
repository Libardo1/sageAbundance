---
layout: 12pt
header-includes:
   - \usepackage{lineno}
   - \linenumbers
   - \usepackage{setspace}
   - \doublespacing
bibliography: ~/Dropbox/Bibliography/SageAbundance.bib
csl: components/ecology.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: true
fontsize: 12pt
geometry: margin=1in

---

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\begin{centering}
\textbf{\large{A spatiotemporal modeling framework for forecasting climate change impacts on plant populations over large spatial extents}}

\textsc{\small{Andrew T. Tredennick\footnote{E-mail: atredenn@gmail.com}\textsuperscript{1}, Mevin B. Hooten\textsuperscript{2,3,4,5}, Cameron L. Aldridge\textsuperscript{5,6,7}, Colin G. Homer\textsuperscript{8}, David T. Iles\textsuperscript{1}, Andrew Kleinhesselink\textsuperscript{1}, Eric LaMalfa\textsuperscript{1}, Rebecca Mann\textsuperscript{1}, and Peter B. Adler\textsuperscript{1}}}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, 5230 Old Main Hill, Utah State University, Logan, Utah 84322-5230 USA}} \\*
\textit{\small{\textsuperscript{2}U.S. Geological Survey, Colorado Cooperative Fish and Wildlife Research Unit}} \\*
\textit{\small{\textsuperscript{3}Department of Fish, Wildlife, and Conservation Biology, Colorado State University}} \\*
\textit{\small{\textsuperscript{4}Department of Statistics, Colorado State University}} \\*
\textit{\small{\textsuperscript{5}Graduate Degree Program in Ecology, Colorado State University, Fort Collins, CO}} \\*
\textit{\small{\textsuperscript{6}Department of Ecosystem Science and Sustainability and Natural Resource Ecology Laboratory, Colorado State University}} \\*
\textit{\small{\textsuperscript{7}U.S. Geological Survey, Fort Collins Science Center}} \\*
\textit{\small{\textsuperscript{8}U.S. Geological Survey (USGS) Earth Resources Observation and Science (EROS) Center, Sioux Falls, SD}}

\end{centering}

\renewcommand*{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{0}

Abstract
--------
Population modeling inference has traditionally been limited to small scale observational studies.
Yet, global environmental changes, like climate change, tend to play out at the landscape and regional scales, creating a mismatch between current tools and current problems.
New technology is allowing for data products on massive scales covering entire ecosystems and teams are post-processing these data products to turn them into useful ecological information.
For example, plant ecologists now have access to species-specific estimates of plant percent cover through time at spatial extents ranging from landscapes to continents.
The real strength to be gained using this new form of ecological information will be to move beyond simple descriptive summaries of the data, and couple them with sophisticated model-based statistical approaches that can accommodate more realistic ecological mechanisms.
A major hurdle in properly analyzing these types of data is in building and fitting statistical models that have valid assumptions.
Rigorously accounting for spatial autocorrelation has been a crux in former analyses at large scales, but we can now fit appropriate models using modern, computationally efficient model reparameterizations and dimension reduction techniques.

Here we advance recent work on spatiotemporal modeling of animal abundance by applying those methods to remotely-sensed estimates of plant percent cover at the landscape scale.
We use a 27 year time series of sagebrush (*Artemesia* spp.) percent cover over a $5\times5$ km landscape in southwestern Wyoming to fit a spatiotemporal population model that includes climate covariates.
We then use the model to forecast future population states (percent cover) under projected climate scenarios.
Our analysis suggests sagebrush will increase in cover at this high elevation site, primarily driven by a positive response to spring temperature.
However, gains in cover are not homogeneous in space; we forecast some areas will increase in cover while others will decrease.
Such spatially explicit estimates of increases/decreases in plant abundance have, until now, been elusive.
The spatiotemporal model we describe can be applied to any spatially explicit time series of plant cover.
As such datasets become increasingly available and precise, we expect the methods we use here to become an appealing alternative to species distribution models that lack population dynamics and, generally, estimates of species abundance.

*Key words: population model, climate change, forecasting, spatiotemporal model, remote sensing, sagebrush*, Artemesia, *dimension reduction* 

Introduction
-------------
Forecasting the impacts of climate change on plant populations and communities is a central challenge of modern ecology [@Clark2001; @Petchey2015].
The challenge lies in faithfully representing population dynamics at spatial and temporal scales relevant to policy and management decisions [@Queenborough2011, Tredennick and Adler in review].
However, almost every study of plant population dynamics relies on demographic observations recorded at the meter to sub-meter scale [@Salguero-Gomez2015].
Local-scale demographic data make building population projection models an easy task [@Ellner2006; @Rees2009; @Adler2012], but it is very difficult to extrapolate small-scale studies to large spatial extents with any certainty because the data likely only represent a small subset of parameter space and environmental conditions [@Freckleton2011; @Queenborough2011].
Also, given the costliness (in time and money) of collecting detailed demographic data, it is unlikely that “enough” local-scale data can be collected to accurately project large-scale population dynamics. 

Alternatives to local-scale demographic data are rapidly becoming available.
Forest Inventory and Analysis (FIA) data have been successfully used to fit sophisticated species distribution models (SDMs) that predict occurance and abundance at large spatial extents [@Clark2014].
However, all SDMs rely on correlations in space, which have been shown to perform poorly relative to models based on responses to changes in climate over time [@Clark2011].
Likewise, distributed demographic data, like FIA data, are not continuous in space.
So creating continuous prediction surfaces requires extrapolating predictions to areas not covered by the data.


Materials and Methods
---------------------
### Data
#### Remotely-sensed time series
To demonstrate our pixel-based modeling approach we use a subset of a remotely-sensed time series of sagebrush (\emph{Artemisia} spp.) shrub percent cover in Wyoming [@Homer2012] (Figure 1).
Sagebrush percent cover was estimated using a regression tree to relate ground reflectances retrieved by three sources of optical imagery (QuickBird, Landsat, and AWiFS) to 1 780 field observations of sagebrush cover distributed across Wyoming.
The regression tree model was further validated using another 500 field observations. For Wyoming sagebrush, the model achieved an $R^{2}$ = 0.65.
To hind-cast sagebrush cover the regression tree model was applied to historical remote sensing images. This resulted in an annual time series of sagebrush cover at 30 m resolution from 1984 to 2011.
In this dataset, values represent the percentage of a 30 $\times$ 30 m pixel covered by sagebrush.
For our purposes we use two 5 $\times$ 5 km subsets (study areas 1 and 2), totaling 27 948 pixels each.
Thus, each full dataset contains 754 596 observations (27 years $\times$ 27 948 pixels).

#### Climate covariates
Our approach is based on modeling how changes in plant populations relate to climate variables.
We narrowed our focus to climate covariates we know are important for sagebrush and that could be easily calculated from general circulation model projections.
The four climate variables in our population model are: (1) year \emph{t} fall through summer precipitation, (2) year \emph{t}-1 fall through summer precipitation, (3) year \emph{t} average spring temperature, and (4) year \emph{t}-1 average spring temperature (Table #).
We downloaded daily historic weather data from the parameter-elevation regressions on independent slopes model (PRISM) data set (*available online*)[^link].
The PRISM weather data is interpolated between coarse observation units and does capture some spatial variation.
However, instead of further downscaling the 800 meter resolution weather data to match our 30 meter resolution percent cover data, we chose to simply extract weather data for the centroid of our study area.
We calcualted the four climate variables outline above from the PRISM data for the time period of our remotely sensed data (1984 to 2011).

[^link]: http://www.prism.oregonstate.edu/

To forecast future population states, we required future projections of climate for our study area.
We downloaded the most recent climate projections used by the Intergovernmental Panel on Climate Change (IPCC), the Coupled Model Intercomparison Project 5 (CMIP5; *available online*)[^link2].
The CMIP5 provides projections from a suite of global circulations models.
For our purposes, we averaged all model projections for the centroid of our study area over the time period of 2050 to 2100.
We did the same for the time period of 1950 to 2000 so we could calculate projected changes in climate.
To keep the temporal variability from observed climate consistent, for climate change scenarios we adjusted observed climate according to projected changes.
For temperature we subtracted the average historic (1950-2000) temperature from the average projected (2050-2100) temperature. 
For precipitation we calculated the proportional change: we subtracted average projected (2050-2100) precipitation from average historic (1950-2000) precipitation, and then divided by average historic (1950-2000) precipitation. 
We did this for three ``Representative Concentration Pathways'': RCP 4.5, RCP 6.0, and RCP 8.5 (*described online*)[^link3].
The three RCPs correspond to stabilization of radiative forcing before 2100, after 2100, and increasing greenhouse gas emissions, respectively.
We implemented projected temperature and precipitation changes in the model by perturbing observed annual values by the values in Table #.

[^link2]: http://cmip-pcmdi.llnl.gov/cmip5/
[^link3]: http://tntcat.iiasa.ac.at/RcpDb/

\begin{table}[h]
\protect\caption{\label{tab:Changes-in-climate}Changes in climate variables from CMIP5
average projections.}
\begin{tabular}{llllll}
\hline
 & \multicolumn{2}{c}{Study Area 1} &  & \multicolumn{2}{c}{Study Area 2}\tabularnewline 
Emissions Scenario & $\Delta$ temperature & $\Delta$ precipitation &  & $\Delta$ temperature & $\Delta$ precipitation\tabularnewline
\hline
RCP 4.5 & 2.98\textdegree & 8.94\% &  & 3.04\textdegree & 7.42\%\tabularnewline
RCP 6.0 & 3.13\textdegree & 8.64\% &  & 3.23\textdegree & 6.72\%\tabularnewline
RCP 8.5 & 4.79\textdegree & 11.0\% &  & 4.90\textdegree & 8.81\%\tabularnewline
\hline
\end{tabular}
\end{table}

### Additive spatio-temporal model for sagebrush cover
We use a descriptive model for sagebrush cover that includes additive spatial and temporal effects (Conn et al. 2015).
We model observed integer percent cover (*y*) in cell *i* at time *t* as conditionally negative binomial

\begin{align}
y_{i,t} \sim \text{NegBinom}(\mu_{i,t}, \zeta),
\end{align}

where $\mu_{i,t}$ is the expected percent cover of pixel *i* in year *t*

\begin{align}
\text{log}(\mu_{i,t}) &= \underbrace{\beta_{0} + \beta_{1}y_{i,t-1}}_\text{temporal} + \underbrace{\textbf{x}_{t}'\boldsymbol{\gamma}}_\text{climate} + \underbrace{\eta_{i}}_\text{spatial}.
\end{align}

Our model of percent cover change includes a temporal effect of cover in the previous year ($y_{i,t-1}$), climate effects ($\textbf{x}_t$), and a spatial random effect ($\eta$) for each pixel *i*.
Climate effects were standardized [$(x_{i}-\bar{x}) / \sigma(x)$] to speed up convergence during the model fitting stage (see below).
We chose a negative binomial likelihood because integer percent cover is a form of count data, and the negative binomial distribution allows for slightly more dispersion than the poisson.

Fitting the model with a spatial random effect ($\eta$) is computationally demanding when a large number of observations are considered.
This is due to the required calculations of the resulting covariance matrices, which increase as a cubic function of the number of locations (Wikle 2010).
To overcome these computational constraints, we employed a dimension reduction strategy to reduce the number of parameters that need to be estimated to account for spatial variation.
Reducing the number of effective spatial random effect parameters speeds up estimation by reducing the size of the covariance matrices that need to be inverted at each MCMC iteration.
Fitting models that appropriately account for spatial autocorrelation over large spatial extents would be virtually impossible without these modern techniques.
We follow a common dimension reduction strategy, and express the high dimensional spatial random effect, $\boldsymbol{\eta}$, as the product of an expansion matrix, \textbf{K}, and a smaller parameter vector, $\boldsymbol{\alpha}$ [@Hooten2007a; @Conn2015].
We can then define the spatial effect as

\begin{align}
\boldsymbol{\eta} &= \textbf{K}\boldsymbol{\alpha}, \\
\alpha_{j} &\sim \text{Normal}(0,\sigma_{\eta}^2).
\end{align}

In this case, $\boldsymbol{\alpha}$ is a $m \times 1$ vector of reduced spatial random effects, and \textbf{K} is a $S \times m$ matrix that maps the reduced effects to the full \emph{S}-dimensional space, where \emph{S} is the total number of observed locations.
Thus, we are able to reduce the effective number of parameters from ${S}$ to $m$.

The last remaining obstacle is to parameterize \textbf{K}.
Here we use kernel convolution [@Barry1996; @Higdon1998] to interpolate the spatial random effect between \emph{m} "knots" that are nonrandomly distributed across the space of our study area.
This means we are modeling spatial random effects at the knot level, and we use \textbf{K} to interpolate those effects between knots.
We use an exponential kernel density to define the distance-decay function around the knots (\textbf{w}), such that the entries of \textbf{K} are

\begin{align}
K_{s,m} &= w_{s,m} / \sum_{s} w_{s,m}
\end{align}
where
\begin{align}
w_{s,m} &= (2 \pi \sigma)^{-1} \text{exp}\left(\frac{-d_{s,m}}{2 \sigma}\right).
\end{align}

where $d_{s,m}$ is the Euclidean distance between the centroid of sample cell \emph{s} and the location of knot \emph{m}, and $\sigma$ is the kernel bandwidth.
It is possible through exhaustive model selection and fitting to determine the optimal form of the kernel and to estimate optimal values for $\sigma$ [@Higdon2002; @Hooten2014].
However, given the relative largeness of our dataset and computational limitations, we defined kernels around 271 knots (Figure 2) whose nearest neighbor distances are approximately equal to the range of spatial dependence in residuals from a simple GLM fit without climate covariates and the spatial random effect (Appendix A).

The Bayesian posterior distribution can be expressed as

\begin{align}
[\boldsymbol{\beta}, \boldsymbol{\gamma}, \boldsymbol{\alpha}, \sigma_{\eta}^2, \zeta | \textbf{y}] \propto \left( \prod_{t=1}^{T} \prod_{i=1}^{n} [y_{i,t} | \boldsymbol{\beta}, \boldsymbol{\gamma},\boldsymbol{\alpha}, \zeta] \right) \prod_{j=1}^{J}[\alpha_j|\sigma_{\eta}^2][\beta_{0}][\beta_{1}][\gamma][\zeta][\sigma_{\eta}^2].
\end{align}

### Computing
####Fitting the model
We fit the model in R [@R2013] using the 'No-U-Turn' MCMC sampler in Stan [@stan2014] and the RStan package [@rstan2014].
We obtained posterior distributions of all model parmaters from three MCMC chains comprised of 1 000 iterations each, after discarding an initial 1 000 iterations as burn in.
Such short MCMC chains may seem unusual to those more familiar with other MCMC samplers (e.g., JAGS or WinBUGS).
However, the Stan sampler is extremely efficient, meaning that, compared to other samplers, fewer iterations are required to achieve convergence.
We assessed convergence visually and ensured all scale reduction factors were less than 1.01 [@Gelman1992; @Gelman2007]. 

####Simulating the model
Using the posterior distribution of model parameters, we simulate a matrix of pixels equal to the size of the study area (XX XXX pixels or matrix elements).
We initialized all pixels with arbitrarily low cover (1%) and then projected the model forward by randomly drawing climate covariates from the observed climate time series.
We ran the simulation for 2 500 time steps and then compared the output to the observed time series to see if the model could reproduce the observed cover.
We then ran simulations where the projected climate changes in Table 1 were applied to the observed climate time series.

Results
-------
Our pixel-based population model was able to reproduce observed percent cover (Figure 3).
Three of five climate covariates were strong predictors of cover change (Figure 4).
In particular, mean spring temperature and precipitation at time *t*-2 had strong positive effects on population growth, only slightly offset by a negative effect of precipitation at time  *t*-1.
The positive effects of precipitation and temperature resulted in projected increases of cover for all climate change scenarios (Figure 5) since precipitation and temperature are both predicted to increase (Table 1).

Discussion
-----------


\pagebreak{}

Figures
-------
```{r figure_1,dependson="plot-options", fig.cap="Location of the study area in southwester Wyoming and a snapshot of the percent cover data in 1984 for each site (a and b). Green shading on the map shows projected distribution of sagebrush from Kuchler (19xx). Latitude and longitude are in decimal degrees.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("components/figure/StudyAreasMap_1and2.png")
grid.raster(img)
```


```{r figure_2,dependson="plot-options", fig.cap="Average percent cover or each grid cell of the study area with knots used for spatial convolution in dimension reduction.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("components/figure/SAGE_Grid_wKnots.png")
grid.raster(img)
```

```{r figure_3,dependson="plot-options", fig.cap="Observed and predicted cover, averaged over years for each pixel. This histogram shows the distribution of observed cover and then density curve shows the distribution of predicted cover from the model.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("../results/obs_pred_spatial_small.png")
grid.raster(img)
```

```{r figure_4,dependson="plot-options", fig.cap="Posterior distributions of climate covariates.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("../results/climeff_dens_small.png")
grid.raster(img)
```

```{r figure_5,dependson="plot-options", fig.cap="Projected equilibrium cover under climate change scenarios. Top panels show the projections in space, averaged over time for each pixel. Lower panel shows distributions of cover under each scenario.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("../results/climchange_small.png")
grid.raster(img)
```

\pagebreak{}

References
----------