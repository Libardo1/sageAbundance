---
layout: 12pt
header-includes:
   - \usepackage{lineno}
   - \linenumbers
   - \usepackage{setspace}
   - \doublespacing
bibliography: ~/Dropbox/Bibliography/SageAbundance.bib
csl: components/ecology.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: true
fontsize: 12pt
geometry: margin=1in

---

```{r figures_source, include=FALSE, eval=FALSE}
## Source this for updated figures
source("../devel/ms_scripts.R")
```

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\begin{centering}
\textbf{\large{A spatiotemporal modeling framework for forecasting climate change impacts on plant populations over large spatial extents}}

\textsc{\small{Andrew T. Tredennick\footnote{Corresponding author: atredenn@gmail.com}\textsuperscript{1}, Mevin B. Hooten\textsuperscript{2,3,4,5}, Cameron L. Aldridge\textsuperscript{5,6,7}, Colin G. Homer\textsuperscript{8}, David T. Iles\textsuperscript{1}, Andrew Kleinhesselink\textsuperscript{1}, Eric LaMalfa\textsuperscript{1}, Rebecca Mann\textsuperscript{1}, and Peter B. Adler\textsuperscript{1}}}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, 5230 Old Main Hill, Utah State University, Logan, Utah 84322 USA}} \\*
\textit{\small{\textsuperscript{2}U.S. Geological Survey, Colorado Cooperative Fish and Wildlife Research Unit, Colorado State University, Fort Collins, CO 80523 USA}} \\*
\textit{\small{\textsuperscript{3}Department of Fish, Wildlife, and Conservation Biology, Colorado State University, Fort Collins, CO 80523 USA}} \\*
\textit{\small{\textsuperscript{4}Department of Statistics, Colorado State University, Fort Collins, CO 80523 USA}} \\*
\textit{\small{\textsuperscript{5}Graduate Degree Program in Ecology, Colorado State University, Fort Collins, CO 80523 USA}} \\*
\textit{\small{\textsuperscript{6}Department of Ecosystem Science and Sustainability and Natural Resource Ecology Laboratory, Colorado State University, Fort Collins, CO 80523 USA}} \\*
\textit{\small{\textsuperscript{7}U.S. Geological Survey, Fort Collins Science Center, Fort Collins, CO 80526 USA}} \\*
\textit{\small{\textsuperscript{8}U.S. Geological Survey (USGS) Earth Resources Observation and Science (EROS) Center, Sioux Falls, SD 57198 USA}}

\end{centering}

\renewcommand*{\thefootnote}{\arabic{footnote}}
\setcounter{footnote}{0}

Abstract
--------
Population modeling inference has traditionally been limited to small scale observational studies.
Yet, global environmental changes, like climate change, tend to play out at the landscape and regional scales, creating a mismatch between current tools and current problems.
New technology is allowing for data products on massive scales covering entire ecosystems and teams are post-processing these data products to turn them into useful ecological information.
For example, plant ecologists now have access to species-specific estimates of plant percent cover through time at spatial extents ranging from landscapes to continents.
The real strength to be gained using this new form of ecological information will be to move beyond simple descriptive summaries of the data, and couple them with sophisticated model-based statistical approaches that can accommodate more realistic ecological mechanisms.
A major hurdle in properly analyzing these types of data is in building and fitting statistical models that have valid assumptions.
Rigorously accounting for spatial autocorrelation has been a crux in former analyses at large scales, but we can now fit appropriate models using modern, computationally efficient model reparameterizations and dimension reduction techniques.

Here we advance spatiotemporal modeling of plant populations by applying recent developments in the modeling of animal abundances to remotely-sensed estimates of plant percent cover at the landscape scale.
We use a 27 year time series of sagebrush (*Artemesia* spp.) percent cover over a $5\times2.5$ km landscape in southwestern Wyoming to fit a spatiotemporal population model that includes climate covariates.
We then use the model to forecast future population states (percent cover) under projected climate scenarios.
Our analysis suggests sagebrush will increase in cover at this high elevation site, primarily driven by a positive response to spring temperature.
However, gains in cover are not homogeneous in space.
Such spatially explicit estimates of increases/decreases in plant abundance have, until now, been elusive.
The spatiotemporal model we describe can be applied to any spatially explicit time series of plant cover.
As such datasets become increasingly available and precise, we expect the methods we use here to become an appealing alternative to species distribution models that lack population dynamics and, generally, estimates of species abundance.

*Key words: population model, climate change, forecasting, spatiotemporal model, remote sensing, sagebrush*, Artemesia, *dimension reduction* 

Introduction
-------------
Forecasting the impacts of climate change on plant populations and communities is a central challenge of modern ecology [@Clark2001; @Petchey2015].
The challenge lies in faithfully representing population dynamics at spatial and temporal scales relevant to policy and management decisions [@Queenborough2011, Tredennick and Adler in review].
Inference from population models has been limited to small spatial extents because the data required is difficult to collect across wide species ranges.
Indeed, almost every study of plant population dynamics relies on demographic observations recorded at the meter to sub-meter scale [see, e.g., @Salguero-Gomez2015].
Local-scale demographic data make building population projection models an easy task [@Ellner2006; @Rees2009; @Adler2012], but it is very difficult to extrapolate small-scale studies to large spatial extents with any certainty because the data likely only represent a small subset of parameter space and environmental conditions [@Freckleton2011; @Queenborough2011].

The fact that population models typically face spatial constraints may explain the proliferation of studies using species distribution models (SDMs) to infer future states of populations under climate change (CITATIONS).
SDMs are extremely useful tools, but they tend to lack information on population dynamics and states beyond probability of presence.
This means that SDMs provide little information on the future states of populations in the core of their range -- in areas where a species currently exists and is expected to persist in the future.
One of the major advantages of SDMs is their use of remotely sensed covariates that allow for extrapolation across broad spatial extents.
New technologies are now providing information on not just the predictor side of the equation, but also the response side.

Species-specific estimates of plant abundance, usually recorded as percent cover or density, offer new opportunities to model and forecast populations at spatial extents that far exceed those possible using traditional population models.
But, with new opportunities, come new challenges.
In particular, spatially-continuous response variables require accounting of spatial autocorrelation to arrive at statistically rigorous model fits (Wikle and Hooten refs.).
Fortunately, recent advances in the spatiotemporal modeling of animal abundances offer a scaffold for similar work on plant species.

Materials and Methods
---------------------
### Data
#### Remotely-sensed time series
To demonstrate our pixel-based modeling approach we use a subset of a remotely-sensed time series of sagebrush (\emph{Artemisia} spp.) shrub percent cover in Wyoming [@Homer2012].
Sagebrush percent cover was estimated using a regression tree to relate ground reflectances retrieved by three sources of optical imagery (QuickBird, Landsat, and AWiFS) to 1,780 field observations of sagebrush cover distributed across Wyoming.
The regression tree model was further validated using another 500 field observations. For Wyoming sagebrush, the model achieved an $R^{2}$ = 0.65.
To hind-cast sagebrush cover the regression tree model was applied to historical remote sensing images. 
This resulted in an annual time series of sagebrush cover at 30 meter resolution from 1984 to 2011 (Figure 1).
In this dataset, values represent the percentage of a 30 $\times$ 30 meter pixel covered by sagebrush.
For our purposes we use a 5,070 $\times$ 2,430 meter subset totaling 13,689 30 $\times$ 30 meter pixels each year.
Thus, the full dataset contains 369,603 observations (27 years $\times$ 13,689 pixels).

#### Climate covariates
Our approach is based on modeling how changes in plant populations relate to climate variables.
We narrowed our focus to climate covariates we know are important for sagebrush and that could be easily calculated from general circulation model projections.
The four climate variables in our population model are: (1) year \emph{t} fall through summer precipitation, (2) year \emph{t}-1 fall through summer precipitation, (3) year \emph{t} average spring temperature, and (4) year \emph{t}-1 average spring temperature.
We downloaded daily historic weather data from the parameter-elevation regressions on independent slopes model (PRISM) data set (*available online*)[^link].
The PRISM weather data is interpolated between coarse observation units and does capture some spatial variation.
However, instead of further downscaling the 800 meter resolution weather data to match our 30 meter resolution percent cover data, we chose to simply extract weather data for the centroid of our study area.
We calculated the four climate variables outline above from the PRISM data for the time period of our remotely sensed data (1984 to 2011).

[^link]: http://www.prism.oregonstate.edu/

To forecast future population states, we required future projections of climate for our study area.
We downloaded the most recent climate projections used by the Intergovernmental Panel on Climate Change (IPCC), the Coupled Model Intercomparison Project 5 (CMIP5; *available online*)[^link2].
The CMIP5 provides projections from a suite of global circulations models.
For our purposes, we averaged all model projections for the centroid of our study area over the time period of 2050 to 2100.
We did the same for the time period of 1950 to 2000 so we could calculate projected changes in climate.
To keep the temporal variability from observed climate consistent, for climate change scenarios we adjusted observed climate according to projected changes.
For temperature we subtracted the average historic (1950-2000) temperature from the average projected (2050-2100) temperature. 
For precipitation we calculated the proportional change: we subtracted average projected (2050-2100) precipitation from average historic (1950-2000) precipitation, and then divided by average historic (1950-2000) precipitation. 
We did this for three ``Representative Concentration Pathways'': RCP 4.5, RCP 6.0, and RCP 8.5 (*described online*)[^link3].
The three RCPs correspond to stabilization of radiative forcing before 2100, after 2100, and increasing greenhouse gas emissions, respectively.
We implemented projected temperature and precipitation changes in the model by perturbing observed annual values by the values in Table 1.

[^link2]: http://cmip-pcmdi.llnl.gov/cmip5/
[^link3]: http://tntcat.iiasa.ac.at/RcpDb/

### Additive spatio-temporal model for sagebrush cover
We use a descriptive model for sagebrush cover that includes additive spatial and temporal effects [@Conn2015].
We model observed integer percent cover (*y*) in cell *i* at time *t* as conditionally Poisson

\begin{align}
y_{i,t} \sim \text{Poisson}(\mu_{i,t}),
\end{align}

where $\mu_{i,t}$ is the expected percent cover of pixel *i* in year *t*

\begin{align}
\text{log}(\mu_{i,t}) &= \underbrace{\beta_{0} + \beta_{1}y_{i,t-1}}_\text{temporal} + \underbrace{\textbf{x}_{t}'\boldsymbol{\gamma}}_\text{climate} + \underbrace{\eta_{i}}_\text{spatial}.
\end{align}

Our model of percent cover change includes a temporal effect of cover in the previous year ($y_{i,t-1}$), climate effects ($\textbf{x}_t$), and a spatial random effect ($\eta$) for each pixel *i*.
Climate effects were standardized [$(x_{i}-\bar{x}) / \sigma(x)$] to speed up convergence during the model fitting stage (see below).
We chose to use a Poisson likelihood because integer percent cover values can be considered a form of count data.
We also evaluated a negative binomial model, but found little evidence for overdispersion beyond what our model was already accomodating via the spatial random effects ($\boldsymbol{\eta}$).

Fitting the model with a spatial random effect ($\eta$) is computationally demanding when a large number of observations are considered.
This is due to the required calculations of the resulting covariance matrices, which increase as a cubic function of the number of locations [@Wikle2010].
To overcome these computational constraints, we employed a dimension reduction strategy to reduce the number of parameters that need to be estimated to account for spatial variation.
Reducing the number of effective spatial random effect parameters speeds up estimation by reducing the size of the covariance matrices that need to be inverted at each MCMC iteration.
Fitting models that appropriately account for spatial autocorrelation over large spatial extents would be virtually impossible without these modern techniques.
We follow a common dimension reduction strategy, and express the high dimensional spatial random effect, $\boldsymbol{\eta}$, as the product of an expansion matrix, \textbf{K}, and a smaller parameter vector, $\boldsymbol{\alpha}$ [@Hooten2007a; @Conn2015].
We can then define the spatial effect as

\begin{align}
\boldsymbol{\eta} &= \textbf{K}\boldsymbol{\alpha}, \\
\alpha_{j} &\sim \text{Normal}(0,\sigma_{\eta}^2).
\end{align}

In this case, $\boldsymbol{\alpha}$ is a $m \times 1$ vector of reduced spatial random effects, and \textbf{K} is a $S \times m$ matrix that maps the reduced effects to the full \emph{S}-dimensional space, where \emph{S} is the total number of observed locations.
Thus, we are able to reduce the effective number of parameters from ${S}$ to $m$.

The last remaining obstacle is to parameterize \textbf{K}.
Here we use kernel convolution [@Barry1996; @Higdon1998] to interpolate the spatial random effect between \emph{m} "knots" that are nonrandomly distributed across the space of our study area.
This means we are modeling spatial random effects at the knot level, and we use \textbf{K} to interpolate those effects between knots.
We use an exponential kernel density to define the distance-decay function around the knots (\textbf{w}), such that the entries of \textbf{K} are

\begin{align}
K_{s,m} &= w_{s,m} / \sum_{s} w_{s,m}
\end{align}
where
\begin{align}
w_{s,m} &= \text{exp}\left(\frac{-d_{s,m}}{\sigma}\right).
\end{align}

where $d_{s,m}$ is the Euclidean distance between the centroid of sample cell \emph{s} and the location of knot \emph{m}, and $\sigma$ is the kernel bandwidth.
It is possible through exhaustive model selection and fitting to determine the optimal form of the kernel and to estimate optimal values for $\sigma$ [@Higdon2002; @Hooten2014].
However, given the relative largeness of our dataset and computational limitations, we defined kernels around 271 knots (Figure 2) whose nearest neighbor distances are approximately equal to the range of spatial dependence in residuals from a simple GLM fit without climate covariates and the spatial random effect (Appendix A).

The Bayesian posterior distribution can be expressed as

\begin{align}
[\boldsymbol{\beta}, \boldsymbol{\gamma}, \boldsymbol{\alpha}, \sigma_{\eta}^2 | \textbf{y}] \propto \left( \prod_{t=1}^{T} \prod_{i=1}^{n} [y_{i,t} | \boldsymbol{\beta}, \boldsymbol{\gamma},\boldsymbol{\alpha}] \right) \prod_{j=1}^{J}[\alpha_j|\sigma_{\eta}^2][\beta_{0}][\beta_{1}][\boldsymbol{\gamma}][\sigma_{\eta}^2].
\end{align}

### Computing
####Fitting the model
We fit the model in R [@R2013] using the 'No-U-Turn' MCMC sampler in Stan [@stan2014] and the RStan package [@rstan2014].
We obtained posterior distributions of all model parmaters from three MCMC chains comprised of 1 000 iterations each, after discarding an initial 1 000 iterations as burn in.
Such short MCMC chains may seem unusual to those more familiar with other MCMC samplers (e.g., JAGS or WinBUGS).
However, the Stan sampler is extremely efficient, meaning that, compared to other samplers, fewer iterations are required to achieve convergence.
We assessed convergence visually and made sure all scale reduction factors were less than 1.01 [@Gelman1992; @Gelman2007]. 

####Simulating the model
Using the posterior distribution of model parameters, we simulate a matrix of pixels equal to the size of the study area (13,689 pixels or matrix elements).
We initialized all pixels with arbitrarily low cover (1%) and then projected the model forward by randomly drawing climate covariates from the observed climate time series.
We ran the simulation for 2,500 time steps and then compared the output to the observed time series to see if the model could reproduce the observed cover.
We then ran simulations where the projected climate changes in Table 1 were applied to the observed climate time series.

Results
-------
All climate covariates were statistically important predictors of sagebrush cover change, but their values, on a standardized scale, were small (Figure 2).
Temperature and precipitation covariates tended to have a positive effect on sagebrush cover change, but *ppt1* had a negative effect (Figure 2).
The mean posterior estimate for the spatial random effect, $\boldsymbol{\eta}$, captured the overall spatial structure of the observed data (Figure 3).
This indicates our choice of knot placement and dimension reduction strategy was adequate for describing permanent spatial variation in the data.

When we simulated the pixel-based population model based on observed climate it was able to reproduce average observed percent cover (Figures 4 and 5).
As expected based on the overall positive effects of temperature on sagebrush cover change (Figure 2), our model predicts increases in sagebrush cover under each climate change scenario (Figure 6).
In general, increases in percent cover tend to occur in areas with above-average percent cover (red areas in Figure 6A "CURRENT").
Indeed, density curves of projected cover under the climate change scenarios (Figure 7) show that low cover pixel are generally retained (all curves overlap at low cover), while high cover pixels are added (increased right skew in climate change curves; Figure 7).

Discussion
-----------
Landscape scale population models for plant species have been elusive.
Yet, the need to forecast population responses to climate change over large spatial extents is clear, as demonstrated by the wide application of species distribution models [see @Clark2014].
Here we introduced a new statistical approach to modeling plant populations that overcame two major hurdles for spatially-explicit population models.
First, we used species-specific remote sensing data as a response variable.
Thus, we had at our disposal spatially-continuous estimates of sagebrush abundance over a large spatial extent, meaning we could fit a model at the same spatial resolution and extent. 
In so doing we overcame a major limitation of most population models that are fit using detailed data from a single location.
Second, borrowing from the vast literature on spatiotemporal modeling of animal abundance [@Conn2015], we employed a dimension reduction strategy to rigorously account for spatial autocorrelation (Figure 3).

The major advantage of our approach is that, once fit, the model can be used to project future changes in population abundance (here, percent cover) in space (Figure 6). 
However, several *a priori* modeling decisions determined the spatial extent and resolution of our results. 
We decided to work at the native spatial resolution of the remote sensing data ($30\times30$ meters). 
This constrained the extent that we could reasonably model because we needed to place the knots for the spatial ranom effect close enough together to detect the underlying spatial structure. 
As more and more knots are used, computation time increases substantially [@Wikle2010].
Had we decided to aggregate the original data to a coarser resolution, we would have been able to model a larger spatial extent using the same number of knots, and therefore computation time.

Our decision on spatial extent and resolution also impacted our incorporation of climate covariates.
We decided against further downscaling PRISM data to match the spatial resolution of the sagebrush data.
This means that in each year, all pixels share the same climate covariates.
In other words, climate only varied through time and not over space.
This is a of course a limitation of our study, and helps to explain why climate coefficients were so certain (Figure 3).
In the future we plan to work at a lower spatial resolution but a larger spatial extent so that we can use spatially-explicit climate covariates that match the resolution of the percent cover data.

These decisions ultimately affect our results, in positive and negative ways, but also show the flexibility of the approach we developed.
The underlying model we described and its subsequent use for projecting population changes remains unchanged in the face of individual choices regarding spatial extent and resolution.
Likewise, the approach can be used for any spatially-explicit time series of species-specific estimates of plant cover or density.
As such datasets become more available, we anticipate the approach we developed here to complement studies using species distribution models and local-scale demographic population models.


\pagebreak{}

Tables
------
\begin{table}[h]
\protect\caption{\label{tab:Changes-in-climate}Changes in climate variables from CMIP5
average projections.}
\begin{tabular}{llllll}
\hline
 & \multicolumn{2}{c}{Study Area 1} &  & \multicolumn{2}{c}{Study Area 2}\tabularnewline 
Emissions Scenario & $\Delta$ temperature & $\Delta$ precipitation &  & $\Delta$ temperature & $\Delta$ precipitation\tabularnewline
\hline
RCP 4.5 & 2.98\textdegree & 8.94\% &  & 3.04\textdegree & 7.42\%\tabularnewline
RCP 6.0 & 3.13\textdegree & 8.64\% &  & 3.23\textdegree & 6.72\%\tabularnewline
RCP 8.5 & 4.79\textdegree & 11.0\% &  & 4.90\textdegree & 8.81\%\tabularnewline
\hline
\end{tabular}
\end{table}

\pagebreak{}

Figures
-------
```{r figure_1_alt,dependson="plot-options", fig.cap="Location of the study area in southwester Wyoming and a snapshot of the percent cover data in 1984 for each site (a and b). Green shading on the map shows projected distribution of sagebrush from Kuchler (19xx). Latitude and longitude are in decimal degrees.", fig.height=6, eval=FALSE}
library(png)
library(grid)
img <- readPNG("components/figure/StudyAreasMap_1and2.png")
grid.raster(img)
```


```{r figure_1,dependson="plot-options", fig.cap="Percent cover in space and time for our study area in southwestern Wyoming.", eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/all_years_percCover.png")
grid.raster(img)
```

```{r figure_2,dependson="plot-options", fig.cap="Posterior distributions of climate covariates. The x-axis is the standardized coefficient value because we fit the model using standardized covariate values. All covariates are statistically important since their distributions do not overlap zero. However, the effects are relatively small.", fig.height=4, eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/post_climate_covariates.png")
grid.raster(img)
```


```{r figure_3,dependson="plot-options", fig.cap="Standardized percent cover showing the general spatial structure of above and below average pixels in the data (top panel) compared to the mean posterior estimate of the spatial field, $\\eta$ (bottom panel).", eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/spatialfield.png")
grid.raster(img)
```

```{r figure_4,dependson="plot-options", fig.cap="Projected equilibrium cover from simulations using observed climate (top panel) and average observed percent cover (bottom panel).", eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/obs_pred_spatial_subset.png")
grid.raster(img)
```

```{r figure_5,dependson="plot-options", fig.cap="Histograms of projected equilibrium cover from simulations using observed climate (orange) and average observed percent cover (black).", eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/obs_pred_hist.png")
grid.raster(img)
```

```{r figure_6,dependson="plot-options", fig.cap="Projected equilibrium cover under climate change scenarios. Top panels shows equilibrium cover based on simulations using observed cliamte. Subsequent paneld show equilibrium cover based on perturbed climate for each RCP scenario.", eval=TRUE}
library(png)
library(grid)
img <- readPNG("../results/clim_change_mean_spatial.png")
grid.raster(img)
```

```{r figure_7,dependson="plot-options", fig.cap="Estimated kernel densities for current and projected sagebrush cover across space and simulation time.", eval=TRUE, fig.height=8}
library(png)
library(grid)
img <- readPNG("../results/clim_change_densities.png")
grid.raster(img)
```

\pagebreak{}

References
----------